### ðŸ“‹ Instructions for the **Client** app team (Replit workspace)

> **Goal:** Step 2 must now filter by the updated `country` codes (`"US"`, `"CA"`, `"US/CA"`) that the Staff API now returns.

---

#### 1 â€” Pull the latest data

1. In Replit, open a new terminal tab.
2. Run a manual fetch to verify the fix:

   ```bash
   curl -s "https://staffportal.replit.app/api/public/lenders" | jq 'group_by(.country) | map({country:.[0].country, count:length})'
   ```

   You should see something like:

   ```json
   [
     { "country": "CA", "count": 22 },
     { "country": "US", "count": 20 }
   ]
   ```

---

#### 2 â€” Clear any cached / fallback data

If you store products in **IndexedDB**:

```js
indexedDB.deleteDatabase('lenderProducts');
```

Or, in dev tools â†’ Application â†’ IndexedDB â†’ Delete DB.
Then reload the page so the TanStack Query (or fetch hook) pulls fresh data.

---

#### 3 â€” Confirm Step 2 filter logic

**Location of filter code**
`src/utils/recommendLenders.ts` (or equivalent)

Make sure it uses the **two-letter codes**:

```ts
export function countryMatch(product: LenderProduct, userCountry: string) {
  if (product.country === "US/CA") return true;      // shared products
  return product.country === userCountry;            // exact match
}
```

---

#### 4 â€” Run the UI test

1. In the browser, start a **new application**.
2. **Step 1:** choose **Canada** as headquarters.
3. Proceed to **Step 2**.

   * You should now see the 22 Canadian products (plus any `US/CA` shared).
4. **Step 1:** start another application with **United States** â†’ Step 2 shows the 20 US products.

If products appear instantly (< 1 s) the fix is live.

---

#### 5 â€” Remove the 8-product fallback (optional)

In `fetchLenderProducts.ts`, guard fallback with `if (process.env.NODE_ENV !== "production")` or delete it entirelyâ€”your live DB is now correct.

---

Thatâ€™s it! The Client app is now in sync with the Staff APIâ€™s corrected country codes, and Step 2 should recommend the right products for both US and Canadian users.
