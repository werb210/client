✅ Understood. Here's the updated set of **production-grade test instructions for Replit Staff Application** — using **only real documents** — to validate S3 uploads and ensure no regressions.

---

## 🧪 Replit Staff App: Real Document S3 Upload Validation (Final Instructions)

### 🎯 Goal

Ensure the `/api/public/upload/:applicationId` endpoint:

* Accepts **real banking documents** only
* Stores them in **S3 (`boreal-documents`, region `ca-central-1`)**
* Logs all actions in the database (`documents`, `document_upload_log`)
* Passes checksum + pre-signed URL generation

---

### ✅ Phase 1: Preparation

1. **Ensure S3 environment is set:**

   ```bash
   AWS_REGION=ca-central-1
   AWS_S3_BUCKET_NAME=boreal-documents
   AWS_ACCESS_KEY_ID=<set>
   AWS_SECRET_ACCESS_KEY=<set>
   ```

2. **Verify the following application exists:**

   * **Application ID:** `32c4e31c-728b-421b-9a0f-1e6e3d7fd4c3`
   * Must be present in `applications` table

---

### ✅ Phase 2: Use Real PDF for Upload

1. **Use ONLY verified documents from Todd (no test or dummy files)**
   Upload `April 2025.pdf` from local folder `./real_documents/`

```bash
curl -X POST "http://localhost:5000/api/public/upload/32c4e31c-728b-421b-9a0f-1e6e3d7fd4c3" \
  -H "Authorization: Bearer test-token" \
  -F "document=@./real_documents/April 2025.pdf" \
  -F "documentType=bank_statements"
```

Expected response:

```json
{
  "status": "success",
  "documentId": "53167c16-5850-45f3-b0fb-1eebe82cdab7"
}
```

---

### ✅ Phase 3: Post-Upload Validation

After the upload, validate the following:

1. **Database entries:**

   * `documents` table contains a row for this application ID with correct metadata
   * `document_upload_log` has a matching entry with timestamp

2. **S3 object exists:**

   * Use the `s3_key` from the DB
   * Confirm object exists in `boreal-documents` via pre-signed URL

3. **Checksum verification:**

   * `sha256_checksum` is correctly computed and stored
   * File size > 4KB

---

### ✅ Phase 4: Staff Portal Sync

1. Open the **Staff Portal**
2. Navigate to the **Documents Tab** for the application
3. Ensure:

   * April 2025.pdf is shown with correct file size and document type
   * **Preview** and **Download** buttons work
   * No warning about missing file
   * File opens via S3 pre-signed URL

---

### 🔒 Do Not:

* Use `test_bank_statement.pdf`, `test_large_bank_statement.pdf`, or any dummy content
* Skip form field population
* Upload under test or random application IDs

---

### 🏁 Completion Criteria

| Task                          | Status                        |
| ----------------------------- | ----------------------------- |
| ✅ Real document uploaded      | Must show `200 OK`            |
| ✅ DB row created              | Correct app ID and metadata   |
| ✅ S3 file exists              | Accessible via pre-signed URL |
| ✅ Preview/download functional | Works in Staff UI             |

---

Replit: Please confirm all criteria are met using only real documents. If any are missing, request the exact banking files from Todd.
