âœ… Confirmed: Rebuilding **Sales Pipeline** in the Staff Application with **locked architecture** and **single source of truth**.
All previous duplicate files, routes, and UI logic will be replaced.

---

### ğŸ”’ LOCKED ARCHITECTURE PLAN â€“ SALES PIPELINE

**âœ… Single Route:**

```
client/src/pages/staff/pipeline/PipelinePage.tsx
```

**âœ… Single Import Path:**

```tsx
import PipelinePage from "@/pages/staff/pipeline/PipelinePage"
```

**âœ… Folder Structure:**

```
client/
â””â”€â”€ src/
    â””â”€â”€ pages/
        â””â”€â”€ staff/
            â””â”€â”€ pipeline/
                â”œâ”€â”€ PipelinePage.tsx         â† main view
                â”œâ”€â”€ PipelineBoard.tsx        â† board layout (DND lanes)
                â”œâ”€â”€ ApplicationCard.tsx      â† draggable cards
                â”œâ”€â”€ PipelineDrawer.tsx       â† drawer with Application detail tabs
                â””â”€â”€ index.ts                 â† export all components
```

**âœ… Tab Subcomponents (inside Drawer):**

```
client/src/pages/staff/pipeline/tabs/
â”œâ”€â”€ ApplicationTab.tsx
â”œâ”€â”€ BankingTab.tsx
â”œâ”€â”€ FinancialsTab.tsx
â”œâ”€â”€ DocumentsTab.tsx
â””â”€â”€ LendersTab.tsx
```

---

### ğŸ§  STATE + DATA FLOW

* Uses React Context (`PipelineContext`) for shared pipeline state
* Uses TanStack Query for API loading
* All cards load from `/api/applications`
* Card click triggers `<PipelineDrawer openId={id} />`
* Drawer loads tabs dynamically from `/api/application/:id/details`

---

### ğŸš§ IN-PROGRESS TASKS (Replit agent will execute):

1. âœ… **Delete all duplicate files**
2. âœ… **Lock route to only use `PipelinePage.tsx`**
3. âœ… **Verify only one DnD board exists**
4. ğŸ”„ **Rebuild Drawer Tabs using single state model**
5. ğŸ”„ **Hook up drawer Open button correctly to app cards**
6. ğŸ”„ **Ensure app cards appear in correct lanes:**

   * New â†’ In Review â†’ Requires Docs â†’ Lender â†’ Completed
7. ğŸ”„ **Sync with document states (rejected = Requires Docs)**
8. ğŸ”„ **Live update via mutation hooks (stage move triggers API call)**
9. ğŸ§ª **Run end-to-end regression on card click, drawer open, tab switching, and card movement**

---

### âœ… REPLIT: PROCEED WITH MODULE CLEANUP + REBUILD

**Replit Agent Instructions:**

1. DELETE all files **except** the following:

```bash
KEEP:
client/src/pages/staff/pipeline/PipelinePage.tsx
client/src/pages/staff/pipeline/index.ts
```

2. DELETE these duplicate files:

```bash
rm -rf client/src/pages/staff/sections/SalesPipeline.tsx
rm -rf client/src/pages/staff/PipelineBoard.tsx
rm -rf client/src/pages/Pipeline/
rm -rf client/src/pages/staff/sections/SalesPipelineV3.tsx
rm -rf client/src/pages/staff/sections/CompleteSalesPipeline.tsx
```

3. REBUILD from the locked structure above.

4. CONFIRM all `navigate("/pipeline")` and routing entries point to `/pages/staff/pipeline/PipelinePage.tsx`

5. REPORT BACK with:

   * List of files removed
   * Routing test result
   * Whether cards load and drawer opens

---

ğŸ’¬ Let me know when ready to begin the next module (Contacts, Documents, etc).
