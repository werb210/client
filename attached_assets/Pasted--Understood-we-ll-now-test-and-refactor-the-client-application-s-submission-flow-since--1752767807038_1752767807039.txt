âœ… Understood â€” weâ€™ll now **test and refactor the client applicationâ€™s submission flow**, since:

---

## ğŸ§¾ Current (Outdated) Behavior:

| Stage                         | Action                                                    |
| ----------------------------- | --------------------------------------------------------- |
| **Stage 4 (Contact Info)**    | ğŸ” **Draft application is submitted to staff**            |
| **Stage 5 (Document Upload)** | ğŸ“¤ **Documents are uploaded separately to staff backend** |
| **Stage 7 (Final Step)**      | âœ… Only frontend redirect happens â€” no full resubmission   |

---

## âœ… NEW DESIRED BEHAVIOR:

| Stage                          | Action                                                                                          |
| ------------------------------ | ----------------------------------------------------------------------------------------------- |
| **Stage 7 (Final Submission)** | ğŸ¯ Send entire application + all uploaded documents **in one single API call** to staff backend |

---

## ğŸ” Part 1: DIAGNOSTIC â€“ Is Old Behavior Still in Place?

> âœ… Replit Agent â€” Please **search and confirm** if any of the following still exist:

### ğŸ” Search client codebase:

1. `fetch('/api/public/applications'...)`

   * Occurring **before** final step submission (Stage 7)
   * Likely in `Step4_ContactInfo.tsx` or `Step5_Documents.tsx`

2. `fetch('/api/public/upload/'...)`

   * Look for auto-upload at end of Stage 5
   * Should now be **moved** to final submission payload

---

## ğŸ›  Part 2: REMOVE Old Behavior

> âœ… Replit Agent â€” Once confirmed, remove these:

### ğŸ”§ Delete:

* Any automatic `POST /applications` call triggered before Stage 7
* Any automatic `POST /upload` or `FormData` upload call in Stage 5

### ğŸ§± Replace With:

All data and documents are bundled and submitted only in the final call:

```ts
await fetch(`${API_BASE}/public/applications`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    step1, step3, step4,
    documents: [ { name, base64, mimeType, category }, ... ],
    termsAccepted,
    privacyAccepted
  })
});
```

Ensure `documents` is populated from local state (uploaded files in Stage 5).

---

## âœ… Part 3: TEST

Once updated:

1. Start from Stage 1 â†’ Complete all 7 steps
2. Open Staff backend logs (`application_log.txt`)
3. Confirm:

   * âœ… `POST /applications` fires only once, at end of Stage 7
   * âœ… Payload includes all steps + uploaded documents
   * âœ… Application appears in Sales Pipeline
   * âœ… Documents show up properly and OCR triggers
   * âŒ No partial submissions or intermediate â€œdraftsâ€

---

## ğŸ§¾ Final Report I Need Back

From Replit Agent (Client App):

| Task                                         | Status |
| -------------------------------------------- | ------ |
| Old `/applications` in Stage 4 removed?      | âœ… / âŒ  |
| Old `/upload` in Stage 5 removed?            | âœ… / âŒ  |
| Final `/applications` call has full payload? | âœ… / âŒ  |
| Test submission to staff confirmed working?  | âœ… / âŒ  |

Once confirmed, your system will be **clean, reliable, and fully compliant** with the new workflow. Let me know when this test + cleanup is complete!
