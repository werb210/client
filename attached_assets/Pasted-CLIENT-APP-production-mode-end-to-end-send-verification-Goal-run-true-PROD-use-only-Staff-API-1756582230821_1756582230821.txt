CLIENT APP — production mode & end-to-end send verification

Goal: run true PROD, use only Staff API (no local fallback), confirm sends from UI/API.

Deployment secrets (Deployments → Settings → Deployment secrets):

VITE_STAFF_API_URL = https://staff.boreal.financial/api

VITE_CLIENT_APP_SHARED_TOKEN = same token as Staff (fp 294b3e442db5)

VITE_LOCAL_FALLBACK = false

NODE_ENV = production

Run config (Deployments):

Build: npm run build

Run: npm run start

Confirm the token fp client-side:

node -e 'const c=require("crypto");const fp=s=>c.createHash("sha256").update(s).digest("hex").slice(0,12);console.log("token_fp:",fp(process.env.VITE_CLIENT_APP_SHARED_TOKEN||""))'
# Expect: token_fp: 294b3e442db5


Strict alignment & read checks (from Client shell):

BASE="${VITE_STAFF_API_URL:-https://staff.boreal.financial/api}"
TOK="${VITE_CLIENT_APP_SHARED_TOKEN:?}"

echo -n "Products: "; curl -s -H "Authorization: Bearer $TOK" "$BASE/v1/products"   | jq 'length'    # expect 44
echo -n "Lenders:  "; curl -s -H "Authorization: Bearer $TOK" "$BASE/lenders"       | jq 'length'    # expect ~30
echo -n "ReqDocs:  "; curl -s -H "Authorization: Bearer $TOK" "$BASE/required-docs" | jq 'length'    # expect >=2

# Browser ability to POST from client domain (must be 204)
curl -sI -X OPTIONS "$BASE/applications" \
  -H "Origin: https://client.boreal.financial" \
  -H "Access-Control-Request-Method: POST" | sed -n '1,12p'


UI verification (end-to-end):

Step 2 loads 44 products and recommends per rules (already implemented).

Step 5 fetches live docs from /required-docs (you should see ≥2; more appear automatically as Staff adds).

Create Application via the form → confirm a new application appears in Staff (or capture id from network tab).

Upload Document from Step 5 → ensure field name is file and UI shows returned id/url/status → state moves to uploaded/verified.

Green-light criteria (Client):

Running under npm run start with NODE_ENV=production

Reads match Staff (44/≈30/≥2)

You can submit an application and upload a document successfully from the UI (or via curl)

No local fallback in PROD (VITE_LOCAL_FALLBACK=false)

Token fp = 294b3e442db5