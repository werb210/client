### 1) Secrets: set the EXACT Staff token (fingerprint must be 0944508707a9)
# Replit → Tools → Secrets
#   VITE_STAFF_API_URL = https://staff.boreal.financial/api
#   VITE_CLIENT_APP_SHARED_TOKEN = <paste STAFF CLIENT_SHARED_BEARER exactly>
#   NODE_ENV = production

# Confirm fingerprint locally:
node -e 'const c=require("crypto");const fp=s=>c.createHash("sha256").update(process.env.VITE_CLIENT_APP_SHARED_TOKEN||"").digest("hex").slice(0,12);console.log("CLIENT token_fp:",fp());'
# Expected: CLIENT token_fp: 0944508707a9  (if not, fix the secret)

### 2) Use only one env file
rm -f .env .env.staging .env.test .env.development 2>/dev/null || true
# keep only .env.production WITHOUT tokens (tokens must live in Replit Secrets)
grep -v 'VITE_CLIENT_APP_SHARED_TOKEN\|CLIENT_SHARED_BEARER' .env.production 2>/dev/null | tee .env.production.clean >/dev/null
[ -f .env.production.clean ] && mv .env.production.clean .env.production

### 3) Production build & start (no dev server)
npm run build
# Replit Deploy settings → Build: `npm run build`  • Run: `npm run start`

### 4) HARD refresh the browser client (clear SW/cache once)
# Open the app, then in DevTools Application tab:
#   Clear storage → Unregister service workers → Hard Reload.

### 5) Alignment (STRICT) sanity checks from client shell
BASE="${VITE_STAFF_API_URL:-https://staff.boreal.financial/api}"
TOK="${VITE_CLIENT_APP_SHARED_TOKEN:?missing token}"

echo "Token FP should be 0944508707a9:"
node -e 'const c=require("crypto");const fp=s=>c.createHash("sha256").update(process.env.VITE_CLIENT_APP_SHARED_TOKEN||"").digest("hex").slice(0,12);console.log(fp());'

echo "Headers + counts:"
curl -si -H "Authorization: Bearer $TOK" "$BASE/v1/products" | sed -n '1,20p'
curl -s  -H "Authorization: Bearer $TOK" "$BASE/v1/products" | jq 'length'
curl -s  -H "Authorization: Bearer $TOK" "$BASE/lenders"      | jq 'length'
curl -s  -H "Authorization: Bearer $TOK" "$BASE/required-docs"| jq 'length'

### Expected (STRICT pass):
# - token_fp = 0944508707a9
# - GET /v1/products → 200 with X-DB-Host, X-Instance, Cache-Control:no-store
# - counts ≈ 44 / ≈ 30 / ≥ 3
# - UI loads without blank screen; Step 2 uses live products; Step 5 shows live required docs
