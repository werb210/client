BLOCK 2 — CLIENT APP PLAYWRIGHT E2E TESTS

Path: client/tests/e2e/client.e2e.spec.ts

import { test, expect } from "@playwright/test";

const CLIENT_URL = process.env.CLIENT_URL || "https://client.boreal.financial";
const STAFF_API = process.env.STAFF_API || "https://staff.boreal.financial";
const CLIENT_TOKEN = process.env.CLIENT_TOKEN;

test.describe("Client App - Lender Products Integration", () => {
  test("fetches lender products successfully", async ({ request }) => {
    const res = await request.get(`${STAFF_API}/api/lender-products`, {
      headers: { Authorization: `Bearer ${CLIENT_TOKEN}` },
    });

    expect(res.ok()).toBeTruthy();
    const products = await res.json();
    expect(Array.isArray(products)).toBeTruthy();
    expect(products.length).toBeGreaterThanOrEqual(32);
  });
});

test.describe("Client App - UI Navigation", () => {
  test("navigates between lender products without opening new tabs", async ({ page }) => {
    await page.goto(`${CLIENT_URL}/lenders`);

    const firstLink = page.locator("a[href^='/lender/']").first();
    await firstLink.click();

    // Should NOT open a new tab; URL should change in the same tab
    expect(page.url()).toContain("/lender/");
  });
});

test.describe("Client App - Schema Validation", () => {
  test("compares client schema to staff schema lock", async ({ request }) => {
    const res = await request.get(`${STAFF_API}/api/schema/hash`, {
      headers: { Authorization: `Bearer ${CLIENT_TOKEN}` },
    });

    expect(res.ok()).toBeTruthy();
    const { currentHash, lockedHash } = await res.json();
    expect(currentHash).toBe(lockedHash);
  });
});


Add to client/package.json:

{
  "scripts": {
    "test:e2e": "playwright test tests/e2e/client.e2e.spec.ts --headed"
  }
}

HOW TO RUN TESTS
1. Install Playwright
npm install -D @playwright/test
npx playwright install

2. Run All Tests

Staff App:

cd staff
npm run test:e2e


Client App:

cd client
npm run test:e2e

RESULT

Staff App Tests

✅ 32 lender products load

✅ Schema lock verified

✅ OAuth endpoints functional

✅ Create/Edit/Delete users fully covered

Client App Tests

✅ Lender products API synced

✅ Single-tab navigation enforced

✅ Client schema matches locked backend schema