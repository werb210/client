<!DOCTYPE html>
<html>
<head>
    <title>Document Type Dropdown Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .failure { color: red; }
        .pending { color: orange; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .test-button { background: #007cba; color: white; padding: 10px 20px; border: none; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <h1>üîç Document Type Dropdown Test</h1>
    
    <div class="test-section">
        <h2>üìã Test Instructions</h2>
        <ol>
            <li>Navigate to <a href="/apply/step-5" target="_blank">/apply/step-5</a></li>
            <li>Click "Check Dropdown Presence" button below</li>
            <li>Compare dropdown options with the expected list</li>
            <li>Mark each document type as present/missing</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>üìä Document Type Checklist</h2>
        <button class="test-button" onclick="checkDropdownPresence()">Check Dropdown Presence</button>
        <button class="test-button" onclick="testUploadEndpoint()">Test Upload Endpoint</button>
        
        <table id="checklistTable">
            <thead>
                <tr>
                    <th>Document Type</th>
                    <th>Expected Label</th>
                    <th>Dropdown Present</th>
                    <th>Upload Test</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="checklistBody">
                <!-- Will be populated by JavaScript -->
            </tbody>
        </table>
    </div>

    <div class="test-section">
        <h2>üß™ Upload Test Results</h2>
        <div id="uploadResults">Click "Test Upload Endpoint" to see results</div>
    </div>

    <script>
        const ALL_DOCUMENT_TYPES = [
            { type: 'accounts_payable', label: 'Accounts Payable' },
            { type: 'accounts_receivable', label: 'Accounts Receivable' },
            { type: 'articles_of_incorporation', label: 'Articles of Incorporation' },
            { type: 'balance_sheet', label: 'Balance Sheet' },
            { type: 'bank_statements', label: 'Bank Statements' },
            { type: 'business_license', label: 'Business License' },
            { type: 'business_plan', label: 'Business Plan' },
            { type: 'cash_flow_statement', label: 'Cash Flow Statement' },
            { type: 'collateral_docs', label: 'Collateral Documents' },
            { type: 'drivers_license_front_back', label: 'Driver\'s License (Front & Back)' },
            { type: 'equipment_quote', label: 'Equipment Quote' },
            { type: 'financial_statements', label: 'Accountant Prepared Financial Statements' },
            { type: 'invoice_samples', label: 'Invoice Samples' },
            { type: 'other', label: 'Other Documents' },
            { type: 'personal_financial_statement', label: 'Personal Financial Statement' },
            { type: 'personal_guarantee', label: 'Personal Guarantee' },
            { type: 'profit_loss_statement', label: 'Profit & Loss Statement' },
            { type: 'proof_of_identity', label: 'Proof of Identity' },
            { type: 'signed_application', label: 'Signed Application' },
            { type: 'supplier_agreement', label: 'Supplier Agreement' },
            { type: 'tax_returns', label: 'Tax Returns' },
            { type: 'void_pad', label: 'Voided Check' }
        ];

        function initializeTable() {
            const tbody = document.getElementById('checklistBody');
            tbody.innerHTML = ALL_DOCUMENT_TYPES.map(doc => `
                <tr id="row-${doc.type}">
                    <td><code>${doc.type}</code></td>
                    <td>${doc.label}</td>
                    <td class="pending">‚è≥ Pending</td>
                    <td class="pending">‚è≥ Pending</td>
                    <td class="pending">Not tested</td>
                </tr>
            `).join('');
        }

        function checkDropdownPresence() {
            console.log('üîç Checking dropdown presence...');
            
            // This would need to be run on the actual Step 5 page
            // For now, simulate the check
            ALL_DOCUMENT_TYPES.forEach(doc => {
                const row = document.getElementById(`row-${doc.type}`);
                if (row) {
                    // Simulate checking - in real test, check actual dropdown
                    const dropdownCell = row.cells[2];
                    dropdownCell.className = 'success';
                    dropdownCell.textContent = '‚úÖ Present';
                }
            });
            
            alert('Dropdown check simulated. In real test, verify each document type appears in Step 5 upload UI.');
        }

        async function testUploadEndpoint() {
            const resultsDiv = document.getElementById('uploadResults');
            resultsDiv.innerHTML = '<p>üîÑ Testing upload endpoints...</p>';
            
            const results = [];
            
            for (const doc of ALL_DOCUMENT_TYPES) {
                try {
                    console.log(`Testing upload for ${doc.type}...`);
                    
                    const formData = new FormData();
                    formData.append('documentType', doc.type);
                    formData.append('document', new File(['test content'], `${doc.type}_test.pdf`, { type: 'application/pdf' }));
                    
                    const response = await fetch(`/api/public/upload/test-upload-diagnostic-1753650254760`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    const data = await response.json();
                    const success = response.ok;
                    
                    results.push({
                        type: doc.type,
                        label: doc.label,
                        success: success,
                        status: response.status,
                        message: data.message || data.error || 'OK'
                    });
                    
                    // Update table row
                    const row = document.getElementById(`row-${doc.type}`);
                    if (row) {
                        const uploadCell = row.cells[3];
                        const statusCell = row.cells[4];
                        
                        if (success) {
                            uploadCell.className = 'success';
                            uploadCell.textContent = '‚úÖ Pass';
                            statusCell.className = 'success';
                            statusCell.textContent = 'Working';
                        } else {
                            uploadCell.className = 'failure';
                            uploadCell.textContent = '‚ùå Fail';
                            statusCell.className = 'failure';
                            statusCell.textContent = `Error: ${response.status}`;
                        }
                    }
                    
                } catch (error) {
                    console.error(`Upload test failed for ${doc.type}:`, error);
                    results.push({
                        type: doc.type,
                        label: doc.label,
                        success: false,
                        status: 0,
                        message: error.message
                    });
                    
                    // Update table row with error
                    const row = document.getElementById(`row-${doc.type}`);
                    if (row) {
                        const uploadCell = row.cells[3];
                        const statusCell = row.cells[4];
                        
                        uploadCell.className = 'failure';
                        uploadCell.textContent = '‚ùå Error';
                        statusCell.className = 'failure';
                        statusCell.textContent = 'Network Error';
                    }
                }
                
                // Small delay between requests
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            // Display summary
            const successCount = results.filter(r => r.success).length;
            const totalCount = results.length;
            
            resultsDiv.innerHTML = `
                <h3>üìä Upload Test Summary</h3>
                <p><strong>Success Rate:</strong> ${successCount}/${totalCount} (${((successCount/totalCount)*100).toFixed(1)}%)</p>
                <h4>Failed Tests:</h4>
                <ul>
                    ${results.filter(r => !r.success).map(r => 
                        `<li><code>${r.type}</code>: ${r.message}</li>`
                    ).join('')}
                </ul>
            `;
            
            console.log('Upload test results:', results);
        }

        // Initialize table on page load
        document.addEventListener('DOMContentLoaded', initializeTable);
    </script>
</body>
</html>